apiVersion: v1
data:
  mesh: |-
    accessLogFile: /dev/stdout
    extensionProviders:
    - name: oauth2-proxy
      envoyExtAuthzHttp:
        service: oauth2-proxy.istio-ingress.svc.cluster.local
        port: 4180
        includeHeadersInCheck: ["authorization", "cookie"]
        headersToUpstreamOnAllow: ["x-forwarded-access-token", "authorization", "path", "x-auth-request-user", "x-auth-request-email", "x-auth-request-access-token"]
        headersToDownstreamOnDeny: ["content-type", "set-cookie"]
        includeAdditionalHeadersInCheck:
            X-Auth-Request-Redirect: 'https://%REQ(:authority)%%REQ(:path)%'
kind: ConfigMap
metadata:
  # name is patched in ../../clusters/gke/components.yaml
  name: istio-asm-managed
  namespace: istio-system
