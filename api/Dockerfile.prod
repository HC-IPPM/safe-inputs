# 1. Compile TS
FROM node:lts-alpine3.19 AS build

ENV NODE_ENV development

WORKDIR /app

COPY package*.json ./

RUN npm ci

COPY . /app
RUN npm run build

# 2. Run server, with prod env (no dev dependencies installed, etc)
FROM node:lts-alpine3.19

ENV NODE_ENV production

WORKDIR /app

COPY package*.json ./
RUN npm ci

COPY --from=build /app/dist ./dist

USER node

CMD npm --no-update-notifier start
