// getValidAffectedPackages just needs to return an array of packages and versions [{package, version}]
// errors processing individual packages shouldn't halt the whole process,
// since we don't want to lose any valid information.
// Maybe just log issues as console.error and filter them out of the returned array?

const getAffectedPackages = async (packageIssues) => {
  const affectedPackages = [];

  for (const issue of packageIssues) {
    try {
      const affectedPackageName = issue.affectedPackage;
      const affectedVersion = issue.affectedVersion.name;

      if (affectedPackageName && affectedVersion) {
        affectedPackages.push({ affectedPackageName, affectedVersion });
      } else {
        console.error('Invalid package issue:', issue);
      }
    } catch (error) {
      console.error(`Error processing package issue:`, error);
    }
  }
  return affectedPackages;
};

module.exports = { getAffectedPackages };
