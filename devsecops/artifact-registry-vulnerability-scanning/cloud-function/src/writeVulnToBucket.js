const { Storage } = require('@google-cloud/storage');
const storage = new Storage();

const writeVulnToBucket = async (
  bucketName,
  vulnText, //aka occurance
  vulnId,
  affectedPackage,
  affectedVersion,
  resourceName,
) => {
  try {
    const destinationObjectName = `vulnerabilities/${vulnId}-${affectedPackage}-${affectedVersion}-${resourceName}`;
    const bucket = storage.bucket(bucketName);
    const file = bucket.file(destinationObjectName);
    await file.save(vulnText);
    console.log(
      `Saved ${destinationObjectName} successfully to ${bucketName} bucket`,
    );
  } catch (error) {
    console.error(
      `Failed to write ${destinationObjectName} to bucket: ${error}`,
    );
    throw error;
  }
};

module.exports = { writeVulnToBucket };
