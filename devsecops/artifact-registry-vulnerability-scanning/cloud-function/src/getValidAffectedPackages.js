// getValidAffectedPackages just needs to return an array of packages and versions [{package, version}]
// errors processing individual packages shouldn't halt the whole process,
// since we don't want to lose any valid information.
// Maybe just log issues as console.error and filter them out of the returned array?

const getValidAffectedPackages = async (packageIssues) => {
  const validPackages = [];

  for (const issue of packageIssues) {
    try {
      const affectedPackageName = issue.affectedPackage;
      const affectedVersion = issue.affectedVersion.name;

      if (affectedPackageName && affectedVersion) {
        validPackages.push({ affectedPackageName, affectedVersion });
        console.log(
          `affectedPackage: ${affectedPackageName}, affectedVersion: ${affectedVersion}`,
        );
      } else {
        console.error('Invalid package issue:', issue);
      }
    } catch (error) {
      console.error(`Error processing package issue:`, error);
    }
  }

  return validPackages;
};

module.exports = { getValidAffectedPackages };
