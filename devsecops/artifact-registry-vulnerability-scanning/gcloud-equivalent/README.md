# To manually trigger deployent in non-safe-inputs project

## Provision resources

Login to project with terminal, modify variables (these are for lilakcc project):

```
export BRANCH_NAME=main
export PROJECT_ID=phx-01jcqzx71nn
export PROJECT_NUMBER=$(gcloud projects describe $PROJECT_ID --format="value(projectNumber)")
export BUCKET_NAME=phx-01jcqzx71nn1-bucket-of-risk
export VULN_CLOUD_FUNCTION_SERVICE_ACCOUNT=phx-01jcqzx71nn-vuln-gcf
export REPO_NAME=phx-01jcqzx71nn-repo-of-risk
export REGION=northamerica-northeast1
```

## Run script to provision resources and deploy cloud function

```
./init.sh
```

## Or with deploy with Cloud Build instead

Comment out the deployment / pushing image protion in init.sh, then deploy :

```
gcloud builds submit --config ./devsecops/artifact-registry-vulnerability-scanning/cloudbuild.yaml --substitutions=_BRANCH_NAME=$BRANCH_NAME,_BUCKET_NAME=$BUCKET_NAME,_REGION=$REGION,_VULN_CLOUD_FUNCTION_SERVICE_ACCOUNT=$VULN_CLOUD_FUNCTION_SERVICE_ACCOUNT,_PROJECT_ID=$PROJECT_ID

```

### Push image with vunerabilities to Artifact Registry to see bucket output

If Artifact Registry repo not yet exists:

```
gcloud artifacts repositories create $REPO_NAME \
 --location=northamerica-northeast1 \
 --repository-format=docker  \
 --project=$PROJECT_ID
```

Then get and push image:

```
gcloud auth configure-docker northamerica-northeast1-docker.pkg.dev
docker pull nginx
docker tag nginx northamerica-northeast1-docker.pkg.dev/$PROJECT_ID/$REPO_NAME/nginx
docker push northamerica-northeast1-docker.pkg.dev/$PROJECT_ID/$REPO_NAME/nginx
```
