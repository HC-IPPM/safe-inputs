# To manually trigger deployent in a non-safe-inputs GCP project

## Set up env variables

Authorize project login, modify variables below (these are for lilakcc project - to be deleted):

```
export BRANCH_NAME=main
export PROJECT_ID=phx-01jcqzx71nn
export PROJECT_NUMBER=$(gcloud projects describe $PROJECT_ID --format="value(projectNumber)")
export BUCKET_NAME=phx-01jcqzx71nn1-bucket-of-risk
export VULN_CLOUD_FUNCTION_SERVICE_ACCOUNT=phx-01jcqzx71nn-vuln-gcf
export REPO_NAME=phx-01jcqzx71nn-repo-of-risk
export REGION=northamerica-northeast1
```

## Run script to provision resources and deploy cloud function

```
./init.sh
```

#### To get list of severities of an image (not used in function):

```
gcloud artifacts docker images list --show-occurrences \
northamerica-northeast1-docker.pkg.dev/phx-01jcqzx71nn/phx-01jcqzx71nn-repo-of-risk/nginx
```

#### To get all vunerabilities for an image and save to local file:

```
gcloud artifacts docker images list --show-occurrences \
--occurrence-filter='kind="VULNERABILITY"' --format=json \
northamerica-northeast1-docker.pkg.dev/phx-01jcqzx71nn/phx-01jcqzx71nn-repo-of-risk/nginx > vunerabilities.json
```
